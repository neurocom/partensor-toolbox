<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Partensor: Canonical Polyadic Decomposition</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Partensor
   &#160;<span id="projectnumber">1.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('CpdPage.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Canonical Polyadic Decomposition </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cpd_seq">Sequential Policy</a><ul><li class="level2"><a href="#cpd_full">Implementations with Randomly Generated Data</a></li>
<li class="level2"><a href="#cpd_file">Implementations Reading Tensor/Factors from Files</a></li>
</ul>
</li>
<li class="level1"><a href="#cpd_mpi">Parallel Policy with MPI</a><ul><li class="level2"><a href="#cpd_mpi_full">Implementations with Randomly Generated Data</a></li>
<li class="level2"><a href="#cpd_mpi_file">Implementations Reading Tensor/Factors from Files</a></li>
</ul>
</li>
<li class="level1"><a href="#cpd_omp">Parallel Policy with OpenMP</a><ul><li class="level2"><a href="#cpd_omp_full">Implementations with Randomly Generated Data</a></li>
<li class="level2"><a href="#cpd_omp_file">Implementations Reading Tensor/Factors from Files</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This is a simple user guide of how to use the Canonical Polyadic Decomposition. In this implementation, the <code>Matrix</code> Module from <a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> is used. In all cases of <a class="el" href="CpdPage.html#cpd_seq">Sequential Policy</a> the function needs a <a href="https://gcc.gnu.org/">gcc</a> compiler, <a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> library, and <a href="https://github.com/gabime/spdlog">spdlog</a> library, as specified in the library requirements. For the <a class="el" href="CpdPage.html#cpd_mpi">Parallel Policy with MPI</a> case, <a href="https://www.boost.org/">Boost</a> library and either <a href="https://www.open-mpi.org/">OpenMPI</a> or <a href="https://www.mpich.org/">MPICH</a> are additionally necessary for the tests to be executed, as specified in the library requirements.</p>
<p>The <code>CMakeLists.txt</code> in the <code>test</code> directory can be used as a guide.</p>
<dl class="section note"><dt>Note</dt><dd>In our implementations, we adopt the alternating optimization framework.</dd></dl>
<h1><a class="anchor" id="cpd_seq"></a>
Sequential Policy</h1>
<h2><a class="anchor" id="cpd_full"></a>
Implementations with Randomly Generated Data</h2>
<p>In this case, the tensor is already stored in a <code>Tensor</code> data structure. This tensor can either be read from a file, using <code>read</code> function from <a class="el" href="ReadWrite_8hpp.html">ReadWrite.hpp</a>, or generated randomly, using <code>makeTensor</code>, implemented in <a class="el" href="DataGeneration_8hpp.html">DataGeneration.hpp</a>, as in the following example. Examples for both functions can be found also in <a class="el" href="ReadWritePage.html">Read/Write Data from/in Files</a> and <a class="el" href="DataGenerationPage.html">Data Generation</a>. The user can then specify some options to execute the algorithm. A full list can be found in <a class="el" href="AlsOptionsPage.html">Options for ALS Method</a>. The initial factors are created either randomly or an <code>stl</code> array containing them, can be passed as a parameter. These factors must be stored in <code>Matrix</code> data structure, and can also be read from files as the tensor or randomly created using <code>makeFactors</code>, which is also in <a class="el" href="DataGenerationPage.html">Data Generation</a>. The rank of the factorization <code>rank</code> is required.</p>
<dl class="section note"><dt>Note</dt><dd>- There are 3 additional implementations, where either the options can be ignored and the default values can be used, or start with randomly generated factors. A user can also run tests without specifying the options and the initial factors. There are tests for each of these cases in the <code>test</code> directory (<code>cpd_options.cpp</code>, <code>cpd_factorsinit.cpp</code>, <code>cpd.cpp</code>).</dd>
<dd>
- By enabling <code>writeToFile</code> and specifying <code>final_factors_paths</code> in the <code>options</code> object, the resulting factors can be saved in files. Their location will be indicated in the <code>final_factors_paths</code> variable.</dd></dl>
<table class="cpd_example_full">
<tr>
<td><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PARTENSOR_8hpp.html">PARTENSOR.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    partensor::Init(argc,argv);</div><div class="line"></div><div class="line">    constexpr std::size_t tensor_order = 3;</div><div class="line">    constexpr std::size_t rank         = 2;</div><div class="line">    </div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aa2aede026ede6ffef87210333a735577">Matrix</a>     = <a class="code" href="Tensor_8hpp.html#aa2aede026ede6ffef87210333a735577">partensor::Matrix</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>     = <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">partensor::Tensor&lt;tensor_order&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Status     = <a class="code" href="structpartensor_1_1Status.html">partensor::Status&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Options    = <a class="code" href="structpartensor_1_1Options.html">partensor::Options&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">Constraint</a> = <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">partensor::Constraint</a>;</div><div class="line"></div><div class="line">    std::array&lt;int,tensor_order&gt;    tnsDims = {10, 11, 12};</div><div class="line">    std::array&lt;Matrix,tensor_order&gt; init_factors;</div><div class="line"></div><div class="line">    <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>  tnsX;</div><div class="line">    Options options;</div><div class="line"></div><div class="line">    options.max_iter       = 50;</div><div class="line">    options.constraints[0] = Constraint::nonnegativity;</div><div class="line">    options.constraints[1] = Constraint::unconstrained;</div><div class="line">    options.constraints[2] = Constraint::orthogonality;</div><div class="line">    </div><div class="line">    <a class="code" href="DataGeneration_8hpp.html#a5806ce0be0550c6667ef3c97b112f7a8">partensor::makeTensor</a>(tnsDims, options.constraints, rank, tnsX);</div><div class="line">    <a class="code" href="DataGeneration_8hpp.html#af0596f8b108e355f4cbf1748419dac20">partensor::makeFactors</a>(tnsDims, options.constraints, rank, init_factors);</div><div class="line"></div><div class="line">    Status status = partensor::cpd(tnsX, rank, options, init_factors);</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(std::size_t i=0; i&lt;tensor_order; ++i)</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;\n factor &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; status.factors[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;   </div><div class="line">}</div></div><!-- fragment --> </td></tr>
</table>
<h2><a class="anchor" id="cpd_file"></a>
Implementations Reading Tensor/Factors from Files</h2>
<p>PARTENSOR toolbox provides also more compact implementations, when the Tensor to be factorized or even the starting points-factors are stored on files. Follows, the same implementation as the previous section, but in this case the Tensor and the initialized factors are stored in files in the disk. In this case the length of each dimension of the tensor is needed to be stored in an <code>stl</code> array <code>tnsDims</code>. Again the factorization <code>rank</code> is essential. As for the options, as mentioned in the previous section, a full list of the options can be found in <a class="el" href="AlsOptionsPage.html">Options for ALS Method</a>. Finally, an <code>stl</code> array containing <code>strings</code> with length of <code>tensor_order+1</code>, where index 0 contains the path for the tensor and the rest the paths for the factors.</p>
<dl class="section note"><dt>Note</dt><dd>- There are 3 additional implementations, where either the options can be ignored and the default values can be used, or start with randomly generated factors. A user can also run tests without specifying the options and the initial factors. There are tests for each of these cases in the <code>test</code> directory (<code>cpd_options_file.cpp</code>, <code>cpd_factorsinit_file.cpp</code>, <code>cpd_file.cpp</code>).</dd>
<dd>
- By enabling <code>writeToFile</code> and specifying <code>final_factors_paths</code> in the <code>options</code> object, the resulting factors can be saved in files. Their location will be indicated in the <code>final_factors_paths</code> variable.</dd></dl>
<table class="cpd_example_file">
<tr>
<td><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PARTENSOR_8hpp.html">PARTENSOR.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    partensor::Init(argc,argv);</div><div class="line"></div><div class="line">    constexpr std::size_t tensor_order = 3;</div><div class="line">    constexpr std::size_t rank         = 2;</div><div class="line">    </div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>     = <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">partensor::Tensor&lt;tensor_order&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Status     = <a class="code" href="structpartensor_1_1Status.html">partensor::Status&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Options    = <a class="code" href="structpartensor_1_1Options.html">partensor::Options&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">Constraint</a> = <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">partensor::Constraint</a>;</div><div class="line"></div><div class="line">    std::array&lt;int,tensor_order&gt;             tnsDims = {10, 11, 12};</div><div class="line">    std::array&lt;std::string, tensor_order+1&gt;  paths;</div><div class="line"></div><div class="line">    Options options;</div><div class="line"></div><div class="line">    options.max_iter       = 50;</div><div class="line">    options.constraints[0] = Constraint::nonnegativity;</div><div class="line">    options.constraints[1] = Constraint::unconstrained;</div><div class="line">    options.constraints[2] = Constraint::orthogonality;</div><div class="line"></div><div class="line">    paths[0] = <span class="stringliteral">&quot;../data/tns.bin&quot;</span>;</div><div class="line">    paths[1] = <span class="stringliteral">&quot;../data/A.bin&quot;</span>;</div><div class="line">    paths[2] = <span class="stringliteral">&quot;../data/B.bin&quot;</span>;</div><div class="line">    paths[3] = <span class="stringliteral">&quot;../data/C.bin&quot;</span>;</div><div class="line"></div><div class="line">    Status status = partensor::cpd(tnsDims, rank, paths, options);</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(std::size_t i=0; i&lt;tensor_order; ++i)</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;\n factor &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; status.factors[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;   </div><div class="line">}</div></div><!-- fragment --> </td></tr>
</table>
<h1><a class="anchor" id="cpd_mpi"></a>
Parallel Policy with MPI</h1>
<h2><a class="anchor" id="cpd_mpi_full"></a>
Implementations with Randomly Generated Data</h2>
<p>In this case, the tensor is already stored in a <code>Tensor</code> data structure. This tensor can be generated randomly using <code>makeTensor</code>, implemented in <a class="el" href="DataGeneration_8hpp.html">DataGeneration.hpp</a>, as in the following example. More information about functions to generate pseudo random data can be found in <a class="el" href="DataGenerationPage.html">Data Generation</a>. The user can then specify some options to execute the algorithm. A full list resides here <a class="el" href="AlsOptionsPage.html">Options for ALS Method</a>. </p><dl class="section note"><dt>Note</dt><dd>In the options list, the <code>proc_per_mode</code> array can be used only in an MPI environment.</dd></dl>
<p>The initial factors are created either randomly or an <code>stl</code> array containing them, can be passed as a parameter. These factors must be stored in <code>Matrix</code> data structure, and can also be randomly created using <code>makeFactors</code>, which is also in <a class="el" href="DataGenerationPage.html">Data Generation</a>. Finally, the rank of the factorization <code>rank</code> is necessary.</p>
<dl class="section note"><dt>Note</dt><dd>- There are 3 additional implementations, where either the options can be ignored and the default values can be used, or start with randomly generated factors. A user can also run tests without specifying the options and the initial factors. There are tests for each of these cases in the <code>test</code> directory (<code>cpd_mpi_options.cpp</code>, <code>cpd_mpi_factorsinit.cpp</code>, <code>cpd_mpi.cpp</code>).</dd>
<dd>
- By enabling <code>writeToFile</code> and specifying <code>final_factors_paths</code> in the <code>options</code> object, the resulting factors can be saved in files. Their location will be indicated in the <code>final_factors_paths</code> variable.</dd></dl>
<table class="cpd_mpi_example_full">
<tr>
<td><div class="fragment"><div class="line"><span class="preprocessor">#define USE_MPI 1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PARTENSOR_8hpp.html">PARTENSOR.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    partensor::Init(argc,argv);</div><div class="line">    partensor::MPI_Communicator _comm  = partensor::Partensor()-&gt;MpiCommunicator();</div><div class="line"></div><div class="line">    constexpr std::size_t tensor_order = 3;</div><div class="line">    constexpr std::size_t rank         = 2;</div><div class="line">    </div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aa2aede026ede6ffef87210333a735577">Matrix</a>     = <a class="code" href="Tensor_8hpp.html#aa2aede026ede6ffef87210333a735577">partensor::Matrix</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>     = <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">partensor::Tensor&lt;tensor_order&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Status     = <a class="code" href="structpartensor_1_1Status.html">partensor::MpiStatus&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Options    = partensor::MpiOptions&lt;Tensor&gt;;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">Constraint</a> = <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">partensor::Constraint</a>;</div><div class="line"></div><div class="line">    std::array&lt;int,tensor_order&gt;    tnsDims = {10, 11, 12};</div><div class="line">    std::array&lt;Matrix,tensor_order&gt; init_factors;</div><div class="line"></div><div class="line">    <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>  tnsX;</div><div class="line">    Options options;</div><div class="line"></div><div class="line">    options.max_iter       = 50;</div><div class="line">    options.constraints[0] = Constraint::nonnegativity;</div><div class="line">    options.constraints[1] = Constraint::unconstrained;</div><div class="line">    options.constraints[2] = Constraint::orthogonality;</div><div class="line">    </div><div class="line">    <a class="code" href="DataGeneration_8hpp.html#a5806ce0be0550c6667ef3c97b112f7a8">partensor::makeTensor</a>(tnsDims, options.constraints, rank, tnsX);</div><div class="line">    <a class="code" href="DataGeneration_8hpp.html#af0596f8b108e355f4cbf1748419dac20">partensor::makeFactors</a>(tnsDims, options.constraints, rank, init_factors);</div><div class="line"></div><div class="line">    Status status = partensor::cpd(partensor::execution::mpi, tnsX, rank, options, init_factors);</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span>(_comm.rank() == 0)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span>(std::size_t i=0; i&lt;tensor_order; ++i)</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\n factor &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; status.factors[i] &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> 0;   </div><div class="line">}</div></div><!-- fragment --> </td></tr>
</table>
<h2><a class="anchor" id="cpd_mpi_file"></a>
Implementations Reading Tensor/Factors from Files</h2>
<p>PARTENSOR toolbox provides implementations for these cases, where either the tensor or the factors are stored in files in the disk. They follow, the same implementation as in the previous section. Here, the length of each dimension of the tensor needs to be stored in an <code>stl</code> array, <code>tnsDims</code>. Again, the factorization <code>rank</code> is required. A full list of the options can be found in <a class="el" href="AlsOptionsPage.html">Options for ALS Method</a>. </p><dl class="section note"><dt>Note</dt><dd>In the options list, the <code>proc_per_mode</code> array can be used only in an MPI environment.</dd></dl>
<p>Finally, an <code>stl</code> array of length <code>tensor_order+1</code> is required, which contains <code>strings</code>. The element at index 0 points to the path of the tensor and the rest of the elements point to the paths for the factors respectively.</p>
<dl class="section note"><dt>Note</dt><dd>- There are 3 additional implementations, where either the options can be ignored and the default values can be used, or start with randomly generated factors. A user can also run tests without specifying the options and the initial factors. There are tests for each of these cases in the <code>test</code> directory (<code>cpd_mpi_options_file.cpp</code>, <code>cpd_mpi_factorsinit_file.cpp</code>, <code>cpd_mpi_file.cpp</code>).</dd>
<dd>
- By enabling <code>writeToFile</code> and specifying <code>final_factors_paths</code> in the <code>options</code> object, the resulting factors can be saved in files. Their location will be indicated in the <code>final_factors_paths</code> variable.</dd></dl>
<table class="cpd_mpi_example_file">
<tr>
<td><div class="fragment"><div class="line"><span class="preprocessor">#define USE_MPI 1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PARTENSOR_8hpp.html">PARTENSOR.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    partensor::Init(argc,argv);</div><div class="line">    partensor::MPI_Communicator _comm = partensor::Partensor()-&gt;MpiCommunicator();</div><div class="line">    </div><div class="line">    constexpr std::size_t tensor_order = 3;</div><div class="line">    constexpr std::size_t rank         = 2;</div><div class="line">    </div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>     = <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">partensor::Tensor&lt;tensor_order&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Status     = <a class="code" href="structpartensor_1_1Status.html">partensor::MpiStatus&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Options    = partensor::MpiOptions&lt;Tensor&gt;;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">Constraint</a> = <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">partensor::Constraint</a>;</div><div class="line"></div><div class="line">    Options options;</div><div class="line"></div><div class="line">    std::array&lt;int,tensor_order&gt;            tnsDims = {10, 11, 12};</div><div class="line">    std::array&lt;std::string, tensor_order+1&gt; paths;</div><div class="line"></div><div class="line">    options.max_iter       = 50;</div><div class="line">    options.constraints[0] = Constraint::nonnegativity;</div><div class="line">    options.constraints[1] = Constraint::unconstrained;</div><div class="line">    options.constraints[2] = Constraint::orthogonality;</div><div class="line"></div><div class="line">    paths[0] = <span class="stringliteral">&quot;../data/tnsX_3.bin&quot;</span>;</div><div class="line">    paths[1] = <span class="stringliteral">&quot;../data/A_3.bin&quot;</span>;</div><div class="line">    paths[2] = <span class="stringliteral">&quot;../data/B_3.bin&quot;</span>;</div><div class="line">    paths[3] = <span class="stringliteral">&quot;../data/C_3.bin&quot;</span>;</div><div class="line">    Status status = partensor::cpd(partensor::execution::mpi, tnsDims, rank, paths, options);</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span>(_comm.rank() == 0)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span>(std::size_t i=0; i&lt;tensor_order; ++i)</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;\n factor &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; status.factors[i] &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> 0;   </div><div class="line">}</div></div><!-- fragment --> </td></tr>
</table>
<h1><a class="anchor" id="cpd_omp"></a>
Parallel Policy with OpenMP</h1>
<h2><a class="anchor" id="cpd_omp_full"></a>
Implementations with Randomly Generated Data</h2>
<p>In this case, the tensor is already stored in a <code>Tensor</code> data structure. This tensor can be generated randomly using <code>makeTensor</code>, implemented in <a class="el" href="DataGeneration_8hpp.html">DataGeneration.hpp</a>, as in the following example. More information about functions to generate pseudo random data can be found in <a class="el" href="DataGenerationPage.html">Data Generation</a>. The user can then specify some options to execute the algorithm. A full list resides here <a class="el" href="AlsOptionsPage.html">Options for ALS Method</a>.</p>
<p>Furthermore, an <code>stl</code> array, containing the initial factors, can be passed as a parameter. These factors must be stored in <code>Matrix</code> data structure. They can also be randomly generated using <code>makeFactors</code>, which is also defined in <a class="el" href="DataGenerationPage.html">Data Generation</a>. Finally, the rank of the factorization <code>rank</code> is required.</p>
<dl class="section note"><dt>Note</dt><dd>- There are 3 additional implementations, where either the options can be ignored and the default values can be used, or start with randomly generated factors. A user can also run tests without specifying the options and the initial factors. There are tests for each of these cases in the <code>test</code> directory (<code>cpd_omp_options.cpp</code>, <code>cpd_omp_factorsinit.cpp</code>, <code>cpd_omp.cpp</code>).</dd>
<dd>
- By enabling <code>writeToFile</code> and specifying <code>final_factors_paths</code> in the <code>options</code> object, the resulting factors can be saved in files. Their location will be indicated in the <code>final_factors_paths</code> variable.</dd></dl>
<table class="cpd_omp_example_full">
<tr>
<td><div class="fragment"><div class="line"><span class="preprocessor">#define USE_OPENMP 1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PARTENSOR_8hpp.html">PARTENSOR.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    partensor::Init(argc,argv);</div><div class="line"></div><div class="line">    constexpr std::size_t tensor_order = 3;</div><div class="line">    constexpr std::size_t rank         = 2;</div><div class="line">    </div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aa2aede026ede6ffef87210333a735577">Matrix</a>     = <a class="code" href="Tensor_8hpp.html#aa2aede026ede6ffef87210333a735577">partensor::Matrix</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>     = <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">partensor::Tensor&lt;tensor_order&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Status     = <a class="code" href="structpartensor_1_1Status.html">partensor::OmpStatus&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Options    = <a class="code" href="structpartensor_1_1Options.html">partensor::OmpOptions&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">Constraint</a> = <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">partensor::Constraint</a>;</div><div class="line"></div><div class="line">    std::array&lt;int,tensor_order&gt;    tnsDims = {10, 11, 12};</div><div class="line">    std::array&lt;Matrix,tensor_order&gt; init_factors;</div><div class="line"></div><div class="line">    <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>  tnsX;</div><div class="line">    Options options;</div><div class="line"></div><div class="line">    options.max_iter       = 50;</div><div class="line">    options.constraints[0] = Constraint::nonnegativity;</div><div class="line">    options.constraints[1] = Constraint::unconstrained;</div><div class="line">    options.constraints[2] = Constraint::orthogonality;</div><div class="line">    </div><div class="line">    <a class="code" href="DataGeneration_8hpp.html#a5806ce0be0550c6667ef3c97b112f7a8">partensor::makeTensor</a>(tnsDims, options.constraints, rank, tnsX);</div><div class="line">    <a class="code" href="DataGeneration_8hpp.html#af0596f8b108e355f4cbf1748419dac20">partensor::makeFactors</a>(tnsDims, options.constraints, rank, init_factors);</div><div class="line"></div><div class="line">    Status status = partensor::cpd(partensor::execution::omp, tnsX, rank, options, init_factors);</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(std::size_t i=0; i&lt;tensor_order; ++i)</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;\n factor &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; status.factors[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;   </div><div class="line">}</div></div><!-- fragment --> </td></tr>
</table>
<h2><a class="anchor" id="cpd_omp_file"></a>
Implementations Reading Tensor/Factors from Files</h2>
<p>PARTENSOR toolbox provides implementations for these cases, where either the tensor or the factors are stored in files in the disk. They follow, the same implementation as in the previous section. Here, the length of each dimension of the tensor needs to be stored in an <code>stl</code> array, <code>tnsDims</code>. Again, the factorization <code>rank</code> is required. A full list of the options can be found in <a class="el" href="AlsOptionsPage.html">Options for ALS Method</a>.</p>
<p>Finally, an <code>stl</code> array of length <code>tensor_order+1</code> is required, which contains <code>strings</code>. The element at index 0 points to the path of the tensor and the rest of the elements point to the paths for the factors respectively.</p>
<dl class="section note"><dt>Note</dt><dd>- There are 3 additional implementations, where either the options can be ignored and the default values can be used, or start with randomly generated factors. A user can also run tests without specifying the options and the initial factors. There are tests for each of these cases in the <code>test</code> directory (<code>cpd_omp_options_file.cpp</code>, <code>cpd_omp_factorsinit_file.cpp</code>, <code>cpd_omp_file.cpp</code>).</dd>
<dd>
- By enabling <code>writeToFile</code> and specifying <code>final_factors_paths</code> in the <code>options</code> object, the resulting factors can be saved in files. Their location will be indicated in the <code>final_factors_paths</code> variable.</dd></dl>
<table class="cpd_omp_example_file">
<tr>
<td><div class="fragment"><div class="line"><span class="preprocessor">#define USE_OPENMP 1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PARTENSOR_8hpp.html">PARTENSOR.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    partensor::Init(argc,argv);</div><div class="line"></div><div class="line">    constexpr std::size_t tensor_order = 3;</div><div class="line">    constexpr std::size_t rank         = 2;</div><div class="line">    </div><div class="line">    <span class="keyword">using</span> <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">Tensor</a>     = <a class="code" href="Tensor_8hpp.html#aea4f5ac04b50f95ca3f06e5d5d357e42">partensor::Tensor&lt;tensor_order&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Status     = <a class="code" href="structpartensor_1_1Status.html">partensor::OmpStatus&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> Options    = <a class="code" href="structpartensor_1_1Options.html">partensor::OmpOptions&lt;Tensor&gt;</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">Constraint</a> = <a class="code" href="Constants_8hpp.html#a06fe2f08e3464769fcd7b516b2377ff2">partensor::Constraint</a>;</div><div class="line"></div><div class="line">    std::array&lt;int,tensor_order&gt;             tnsDims = {10, 11, 12};</div><div class="line">    std::array&lt;std::string, tensor_order+1&gt;  paths;</div><div class="line"></div><div class="line">    Options options;</div><div class="line"></div><div class="line">    options.max_iter       = 50;</div><div class="line">    options.constraints[0] = Constraint::nonnegativity;</div><div class="line">    options.constraints[1] = Constraint::unconstrained;</div><div class="line">    options.constraints[2] = Constraint::orthogonality;</div><div class="line"></div><div class="line">    paths[0] = <span class="stringliteral">&quot;../data/tns.bin&quot;</span>;</div><div class="line">    paths[1] = <span class="stringliteral">&quot;../data/A.bin&quot;</span>;</div><div class="line">    paths[2] = <span class="stringliteral">&quot;../data/B.bin&quot;</span>;</div><div class="line">    paths[3] = <span class="stringliteral">&quot;../data/C.bin&quot;</span>;</div><div class="line"></div><div class="line">    Status status = partensor::cpd(partensor::execution::omp, tnsDims, rank, paths, options);</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(std::size_t i=0; i&lt;tensor_order; ++i)</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;\n factor &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; status.factors[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;   </div><div class="line">}</div></div><!-- fragment --> </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
